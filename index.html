<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego de los 5 Porqués</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #003087;
            --primary-light: #e0e7ff;
            --primary-dark: #00205b;
            --accent-color: #d32f2f;
            --accent-light: #ff6659;
            --accent-dark: #9a0007;
            --text-color: #333;
            --light-text: #fff;
            --grey-bg: #f5f5f5;
            --border-radius: 12px;
            --box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
            --transition: all 0.3s ease;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, var(--primary-light), #fff);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1000px;
            width: 90%;
            background: #fff;
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin: 30px auto;
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .logo {
            max-width: 290px;
            margin: 0 auto 10px;
            display: block;
        }

        h1 {
            color: var(--primary-color);
            font-size: 2.2em;
            margin-bottom: 10px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }

        .subtitle {
            color: var(--accent-color);
            font-size: 1.2em;
            margin-bottom: 20px;
        }

        .intro {
            background: var(--grey-bg);
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            text-align: center;
        }

        .problem-card {
            background: var(--accent-color);
            color: var(--light-text);
            padding: 25px;
            border-radius: var(--border-radius);
            text-align: center;
            font-size: 1.2em;
            margin-bottom: 30px;
            box-shadow: var(--box-shadow);
            animation: slideIn 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .problem-card::before {
            content: "";
            position: absolute;
            top: -20px;
            right: -20px;
            width: 100px;
            height: 100px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
        }

        .tabs {
            display: flex;
            margin-bottom: 30px;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: var(--grey-bg);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            border-bottom: 3px solid transparent;
            color: var(--text-color);
        }

        .tab.active {
            background: #fff;
            border-bottom: 3px solid var(--accent-color);
            color: var(--accent-color);
        }

        .tab:hover:not(.active) {
            background: #e9e9e9;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .progress-container {
            margin-bottom: 30px;
        }

        .progress-bar {
            display: flex;
            justify-content: space-between;
            position: relative;
            margin: 15px auto;
            max-width: 600px;
        }

        .progress-bar::before {
            content: "";
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 4px;
            background: #ccc;
            transform: translateY(-50%);
            z-index: 1;
        }

        .progress-line {
            position: absolute;
            top: 50%;
            left: 0;
            height: 4px;
            background: var(--accent-color);
            transform: translateY(-50%);
            transition: width 0.5s ease;
            z-index: 2;
        }

        .progress-step {
            width: 30px;
            height: 30px;
            background: #fff;
            border: 3px solid #ccc;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            position: relative;
            z-index: 3;
            transition: var(--transition);
        }

        .progress-step.active {
            border-color: var(--accent-color);
            background: var(--accent-color);
            color: white;
        }

        .progress-step.completed {
            border-color: var(--accent-color);
            background: var(--accent-color);
            color: white;
        }

        .progress-step.completed::after {
            content: "✓";
            color: white;
        }

        .progress-labels {
            display: flex;
            justify-content: space-between;
            max-width: 600px;
            margin: 5px auto 0;
        }

        .progress-label {
            font-size: 0.8em;
            text-align: center;
            width: 60px;
            margin: 0 -15px;
        }

        .form-card {
            background: var(--primary-light);
            padding: 30px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: var(--transition);
        }

        .form-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        }

        .form-step {
            display: none;
        }

        .form-step.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .form-group {
            margin-bottom: 25px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        label {
            display: block;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        input[type="text"], textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #ccc;
            border-radius: 10px;
            font-size: 1em;
            transition: var(--transition);
            background-color: white;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
            font-family: 'Poppins', sans-serif;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        input[type="text"]:focus, textarea:focus {
            border-color: var(--accent-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(211, 47, 47, 0.2);
        }

        .input-group {
            position: relative;
        }

        .input-icon {
            position: absolute;
            top: 50%;
            left: 15px;
            transform: translateY(-50%);
            color: #777;
        }

        .input-with-icon {
            padding-left: 45px;
        }

        .question-prefix {
            color: var(--accent-color);
            font-weight: bold;
            margin-right: 5px;
        }

        .buttons-group {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .btn {
            background: var(--primary-color);
            color: var(--light-text);
            padding: 12px 25px;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 10px rgba(0, 48, 135, 0.3);
        }

        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 48, 135, 0.4);
        }

        .btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(0, 48, 135, 0.3);
        }

        .btn-prev {
            background: #6c757d;
        }

        .btn-prev:hover {
            background: #5a6268;
        }

        .btn-submit {
            background: var(--accent-color);
            box-shadow: 0 4px 10px rgba(211, 47, 47, 0.3);
        }

        .btn-submit:hover {
            background: var(--accent-dark);
            box-shadow: 0 6px 15px rgba(211, 47, 47, 0.4);
        }

        .results {
            display: none;
        }

        .results-card {
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            box-shadow: var(--box-shadow);
            animation: fadeIn 0.5s ease;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-light);
        }

        .results-title {
            font-size: 1.5em;
            color: var(--primary-color);
            margin: 0;
        }

        .results-stats {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }

        .stat-card {
            text-align: center;
            padding: 15px;
            background: var(--primary-light);
            border-radius: var(--border-radius);
            flex: 1;
            min-width: 150px;
            margin: 0 10px 10px;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: var(--primary-color);
            display: block;
        }

        .stat-label {
            color: var(--text-color);
            font-size: 0.9em;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .answer-card {
            background: var(--grey-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
        }

        .answer-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }

        .answer-card-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: var(--primary-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 10px;
        }

        .answer-item {
            margin-bottom: 10px;
            position: relative;
            padding-left: 25px;
        }

        .answer-item-number {
            position: absolute;
            left: 0;
            top: 3px;
            background: var(--accent-color);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            font-weight: bold;
        }

        .common-points {
            background: linear-gradient(135deg, var(--accent-color), var(--accent-dark));
            color: var(--light-text);
            padding: 25px;
            border-radius: var(--border-radius);
            margin-top: 30px;
            animation: slideIn 0.5s ease;
            box-shadow: var(--box-shadow);
        }

        .common-points h3 {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .common-point-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .badge {
            background: white;
            color: var(--accent-dark);
            border-radius: 20px;
            padding: 2px 10px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .data-visualization {
            margin-top: 40px;
        }

        .chart-container {
            width: 100%;
            height: 300px;
            position: relative;
            margin-top: 20px;
        }

        #wordCloudChart {
            width: 100%;
            height: 100%;
        }

        .dashboard-section {
            margin-bottom: 30px;
        }

        .dashboard-card {
            background: #fff;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 20px;
            margin-bottom: 20px;
        }

        .dashboard-card h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            border-bottom: 2px solid var(--primary-light);
            padding-bottom: 10px;
        }

        .help-text {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        .action-btns {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .btn-reset {
            background: #6c757d;
        }

        .btn-export {
            background: #28a745;
        }

        .btn-export:hover {
            background: #218838;
        }

        footer {
            background: var(--primary-color);
            color: var(--light-text);
            text-align: center;
            padding: 20px;
            margin-top: 30px;
        }

        footer p {
            margin: 0;
            font-size: 0.9em;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            margin-left: 5px;
            cursor: pointer;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8em;
            font-weight: normal;
        }

        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #555 transparent transparent transparent;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .download-section {
            text-align: center;
            margin-top: 30px;
        }

        .confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            display: none;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid var(--primary-light);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            100% {
                transform: rotate(360deg);
            }
        }

        .instruction-card {
            background: var(--grey-bg);
            border-left: 5px solid var(--primary-color);
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
        }

        .instruction-card h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .scroll-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            background: var(--primary-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transition: var(--transition);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            z-index: 100;
        }

        .scroll-to-top.show {
            opacity: 1;
        }

        .scroll-to-top:hover {
            background: var(--primary-dark);
            transform: translateY(-3px);
        }

        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

      
        
        @media (max-width: 768px) {
            .container {
                width: 95%;
                padding: 20px;
                margin: 15px auto;
            }

            h1 {
                font-size: 1.8em;
            }

            .subtitle {
                font-size: 1em;
            }

            .problem-card {
                padding: 15px;
                font-size: 1em;
            }

            .form-card {
                padding: 15px;
            }

            .results-grid {
                grid-template-columns: 1fr;
            }

            .buttons-group {
                flex-direction: column;
                gap: 10px;
            }

            .btn {
                width: 100%;
            }

            .progress-bar {
                max-width: 90%;
            }

            .progress-label {
                font-size: 0.7em;
                width: 40px;
                margin: 0 -10px;
            }

            .stat-card {
                min-width: 120px;
                margin: 0 5px 10px;
            }

            .tabs {
                flex-direction: column;
            }

            .action-btns {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <p>Cargando...</p>
    </div>

</button>

    <div class="container">
        <header>
            <img src="logo.png" alt="YPFB Logo" class="logo">
            <h1>Juego de los 5 Porqués</h1>
            <p class="subtitle">Identificando la causa raíz de los problemas <br> Sabes algo de politica?😑😏</p>
        </header>

        <div class="tabs">
            <div class="tab active" data-tab="game">Juego</div>
            <div class="tab" data-tab="results">Resultados</div>
            <div class="tab" data-tab="dashboard">Dashboard</div>
            <div class="tab" data-tab="about">Acerca del Método</div>
        </div>

        <div class="tab-content active" id="gameTab">
            <div class="intro">
                <p>El método de los 5 Porqués te ayudará a identificar la causa raíz de un problema mediante preguntas consecutivas. Responde honestamente y llega a la verdadera raíz del problema.</p>
            </div>

            <div class="problem-card">
                <h3>Problema a Resolver:</h3>
                <p>Hay un retraso constante en el inicio de proyectos para industrializar el gas natural, como las plantas de urea y amoniaco, en Yacimientos Petrolíferos Fiscales Bolivianos (YPFB). Este problema se debe a decisiones políticas sobre quiénes ocupan los puestos de gerencia, procesos de licitación poco claros y una burocracia interna excesiva. Como resultado, importantes inversiones del Estado quedan sin usar, lo que retrasa la generación de ingresos por la exportación de productos que podrían tener un mayor valor agregado.</p>
            </div>

            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-line" id="progressLine"></div>
                    <div class="progress-step active" data-step="1">1</div>
                    <div class="progress-step" data-step="2">2</div>
                    <div class="progress-step" data-step="3">3</div>
                    <div class="progress-step" data-step="4">4</div>
                    <div class="progress-step" data-step="5">5</div>
                    <div class="progress-step" data-step="6">✓</div>
                </div>
                <div class="progress-labels">
                    <div class="progress-label">Datos</div>
                    <div class="progress-label">Por qué 1</div>
                    <div class="progress-label">Por qué 2</div>
                    <div class="progress-label">Por qué 3</div>
                    <div class="progress-label">Por qué 4</div>
                    <div class="progress-label">Por qué 5</div>
                </div>
            </div>

            <div class="form-card">
                <form id="whysForm">
                    <div class="form-step active" data-step="1">
                        <div class="form-group">
                            <label for="playerName">
                                <i class="fas fa-user"></i> Nombre del participante:
                            </label>
                            <div class="input-group">
                                <input type="text" id="playerName" class="input-with-icon" placeholder="Ingresa tu nombre" required>
                                
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="department">
                                <i class="fas fa-building"></i> Departamento/Área:
                            </label>
                            <div class="input-group">
                                <input type="text" id="department" class="input-with-icon" placeholder="Ej: Operaciones, Administración, etc." required>
                                
                            </div>
                        </div>
                        <div class="buttons-group">
                            <button type="button" class="btn btn-next" onclick="nextStep()">
                                Siguiente <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>

                    <div class="form-step" data-step="2">
                        <div class="form-group">
                            <label for="why1">
                                <span class="question-prefix">1️⃣ ¿Por qué</span> se retrasa la puesta en marcha de los proyectos de industrialización de gas natural en YPFB?
                                <span class="tooltip">
                                    <i class="fas fa-info-circle"></i>
                                    <span class="tooltiptext">Identifica la causa inmediata del problema mencionado en la tarjeta del problema.</span>
                                </span>
                            </label>
                            <textarea id="why1" placeholder="Escribe tu respuesta al primer porqué" required></textarea>
                            <p class="help-text">Sea específico y conciso. Evite respuestas genéricas.</p>
                        </div>
                        <div class="buttons-group">
                            <button type="button" class="btn btn-prev" onclick="prevStep()">
                                <i class="fas fa-arrow-left"></i> Anterior
                            </button>
                            <button type="button" class="btn btn-next" onclick="nextStep()">
                                Siguiente <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>

                    <div class="form-step" data-step="3">
                        <div class="form-group">
                            <label for="why2">
                                <span class="question-prefix">2️⃣ ¿Por qué</span> ocurre lo que escribiste arriba?
                                <span class="tooltip">
                                    <i class="fas fa-info-circle"></i>
                                    <span class="tooltiptext">Profundiza en la causa que identificaste anteriormente para encontrar el factor que la provoca.</span>
                                </span>
                            </label>
                            <textarea id="why2" placeholder="Escribe tu respuesta al segundo porqué" required></textarea>
                            <p class="help-text">Pregúntate qué causa el problema que identificaste en tu respuesta anterior.</p>
                        </div>
                        <div class="buttons-group">
                            <button type="button" class="btn btn-prev" onclick="prevStep()">
                                <i class="fas fa-arrow-left"></i> Anterior
                            </button>
                            <button type="button" class="btn btn-next" onclick="nextStep()">
                                Siguiente <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>

                    <div class="form-step" data-step="4">
                        <div class="form-group">
                            <label for="why3">
                                <span class="question-prefix">3️⃣ ¿Por qué</span> ocurre lo que escribiste arriba?
                                <span class="tooltip">
                                    <i class="fas fa-info-circle"></i>
                                    <span class="tooltiptext">Continúa profundizando para identificar una causa más fundamental del problema.</span>
                                </span>
                            </label>
                            <textarea id="why3" placeholder="Escribe tu respuesta al tercer porqué" required></textarea>
                            <p class="help-text">Sigue avanzando hacia la causa raíz del problema.</p>
                        </div>
                        <div class="buttons-group">
                            <button type="button" class="btn btn-prev" onclick="prevStep()">
                                <i class="fas fa-arrow-left"></i> Anterior
                            </button>
                            <button type="button" class="btn btn-next" onclick="nextStep()">
                                Siguiente <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>

                    <div class="form-step" data-step="5">
                        <div class="form-group">
                            <label for="why4">
                                <span class="question-prefix">4️⃣ ¿Por qué</span> ocurre lo que escribiste arriba?
                                <span class="tooltip">
                                    <i class="fas fa-info-circle"></i>
                                    <span class="tooltiptext">Estamos cerca de la causa raíz. Continúa el análisis profundo.</span>
                                </span>
                            </label>
                            <textarea id="why4" placeholder="Escribe tu respuesta al cuarto porqué" required></textarea>
                            <p class="help-text">Considera factores sistémicos o estructurales que podrían estar causando el problema.</p>
                        </div>
                        <div class="buttons-group">
                            <button type="button" class="btn btn-prev" onclick="prevStep()">
                                <i class="fas fa-arrow-left"></i> Anterior
                            </button>
                            <button type="button" class="btn btn-next" onclick="nextStep()">
                                Siguiente <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>

                    <div class="form-step" data-step="6">
                        <div class="form-group">
                            <label for="why5">
                                <span class="question-prefix">5️⃣ ¿Por qué</span> ocurre lo que escribiste arriba?
                                <span class="tooltip">
                                    <i class="fas fa-info-circle"></i>
                                    <span class="tooltiptext">Esta es la última pregunta. Deberías llegar a la causa raíz fundamental del problema.</span>
                                </span>
                            </label>
                            <textarea id="why5" placeholder="Escribe tu respuesta al quinto porqué" required></textarea>
                            <p class="help-text">La respuesta a esta pregunta debería representar la causa raíz del problema original.</p>
                        </div>
                        <div class="buttons-group">
                            <button type="button" class="btn btn-prev" onclick="prevStep()">
                                <i class="fas fa-arrow-left"></i> Anterior
                            </button>
                            <button type="button" class="btn btn-submit" onclick="submitAnswers()">
                                <i class="fas fa-paper-plane"></i> Enviar Respuestas
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div class="tab-content" id="resultsTab">
            <div class="results" id="results">
                <div class="results-card">
                    <div class="results-header">
                        <h2 class="results-title"><i class="fas fa-clipboard-list"></i> Respuestas de los Participantes</h2>
                        <button class="btn btn-export" onclick="exportResults()">
                            <i class="fas fa-file-export"></i> Exportar
                        </button>
                    </div>
                    
                    <div class="results-stats">
                        <div class="stat-card">
                            <span class="stat-number" id="totalParticipants">0</span>
                            <span class="stat-label">Participantes</span>
                        </div>
                        <div class="stat-card">
                            <span class="stat-number" id="totalDepartments">0</span>
                            <span class="stat-label">Departamentos</span>
                        </div>
                        <div class="stat-card">
                            <span class="stat-number" id="commonPointsCount">0</span>
                            <span class="stat-label">Puntos en común</span>
                        </div>
                    </div>
                    
                    <div class="results-grid" id="resultsGrid"></div>
                </div>
                
                <div class="common-points" id="commonPoints">
                    <h3><i class="fas fa-bullseye"></i> Puntos en común identificados:</h3>
                    <div id="commonPointsList"></div>
                </div>
                
                <div class="data-visualization">
                    <div class="dashboard-card">
                        <h3><i class="fas fa-chart-network"></i> Mapa de Palabras Clave</h3>
                        <div class="chart-container">
                            <div id="wordCloudChart"></div>
                        </div>
                    </div>
                </div>
                
                <div class="action-btns">
                    <button class="btn btn-reset" onclick="resetGame()">
                        <i class="fas fa-redo-alt"></i> Reiniciar Juego
                    </button>
                    <button class="btn btn-export" onclick="generatePDF()">
                        <i class="fas fa-file-pdf"></i> Generar PDF
                    </button>
                </div>
            </div>
            
            <div class="instruction-card" id="noResultsMessage">
                <h3><i class="fas fa-info-circle"></i> No hay resultados disponibles</h3>
                <p>Aún no se han registrado respuestas. Ve a la pestaña "Juego" para empezar a participar.</p>
            </div>
        </div>

        <div class="tab-content" id="dashboardTab">
            <div class="dashboard-section">
                <div class="dashboard-card">
                    <h3><i class="fas fa-tachometer-alt"></i> Dashboard de Análisis</h3>
                    <p>Visualización detallada de los datos recopilados a través del Juego de los 5 Porqués.</p>
                    
                    <div class="chart-container">
                        <canvas id="categoriesChart"></canvas>
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <h3><i class="fas fa-project-diagram"></i> Mapa de Causas Raíz</h3>
                    <div class="chart-container">
                        <canvas id="rootCausesChart"></canvas>
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <h3><i class="fas fa-sitemap"></i> Árbol de Problemas</h3>
                    <div id="problemTree" style="height: 400px;"></div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="aboutTab">
            <div class="dashboard-card">
                <h3><i class="fas fa-info-circle"></i> Acerca del Método de los 5 Porqués</h3>
                <p>El método de los 5 Porqués es una técnica iterativa de preguntas utilizada para explorar las relaciones causa-efecto que generan un problema particular. El objetivo principal es determinar la causa raíz mediante la repetición de la pregunta "¿Por qué?".</p>
                
                <div class="instruction-card">
                    <h3><i class="fas fa-history"></i> Historia</h3>
                    <p>Fue desarrollado por Sakichi Toyoda y utilizado dentro de la Corporación Toyota durante la evolución de sus metodologías de fabricación. Es una herramienta clave en la resolución de problemas y forma parte de la filosofía de mejora continua (Kaizen).</p>
                </div>
                
                <div class="instruction-card">
                    <h3><i class="fas fa-tasks"></i> Proceso</h3>
                    <ol>
                        <li><strong>Identificar el problema:</strong> Definir claramente cuál es el problema que estamos tratando de resolver.</li>
                        <li><strong>Preguntar ¿Por qué?:</strong> ¿Por qué ocurre este problema?</li>
                        <li><strong>Si la respuesta no identifica la causa raíz:</strong> Preguntar ¿Por qué? nuevamente sobre la respuesta anterior.</li>
                        <li><strong>Repetir:</strong> Continuar preguntando ¿Por qué? hasta llegar a la causa raíz (generalmente 5 veces es suficiente).</li>
                        <li><strong>Desarrollar contramedidas:</strong> Una vez identificada la causa raíz, implementar medidas para solucionarla.</li>
                    </ol>
                </div>
                
                <div class="instruction-card">
                    <h3><i class="fas fa-lightbulb"></i> Beneficios para YPFB</h3>
                    <ul>
                        <li>Permite identificar la causa raíz de los retrasos en proyectos de industrialización</li>
                        <li>Ayuda a reducir la incidencia de problemas recurrentes</li>
                        <li>Promueve el pensamiento profundo y analítico entre los equipos</li>
                        <li>Facilita la implementación de soluciones efectivas y duraderas</li>
                        <li>Optimiza procesos internos y la toma de decisiones</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="scroll-to-top" id="scrollToTop">
        <i class="fas fa-arrow-up"></i>
    </div>

    <footer>
        <p>© 2025 Juego 5 Porqués | Desarrollado por Samuel Yura | Todos los derechos reservados.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        // Variables globales
let participants = [];
let currentStep = 1;
let darkTheme = false;
let categoriesChartObj = null;
let rootCausesChartObj = null;

// Inicialización cuando el DOM está listo
document.addEventListener('DOMContentLoaded', function () {
    updateProgressBar(1);
    initTabs();
    initScrollToTop();
    initThemeToggle();
    checkForResults();
});

// Inicialización de pestañas
function initTabs() {
    const tabs = document.querySelectorAll('.tab');
    tabs.forEach(tab => {
        tab.addEventListener('click', function () {
            tabs.forEach(t => t.classList.remove('active'));
            this.classList.add('active');

            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            const tabId = this.getAttribute('data-tab');
            document.getElementById(tabId + 'Tab').classList.add('active');

            if (tabId === 'results') {
                checkForResults();
            } else if (tabId === 'dashboard') {
                generateCharts();
            }
        });
    });
}

// Función para avanzar al siguiente paso
function nextStep() {
    if (!validateCurrentStep()) {
        return;
    }

    if (currentStep < 6) {
        document.querySelector(`.form-step[data-step="${currentStep}"]`).classList.remove('active');
        currentStep++;
        document.querySelector(`.form-step[data-step="${currentStep}"]`).classList.add('active');
        updateProgressBar(currentStep);
    }
}

// Función para retroceder al paso anterior
function prevStep() {
    if (currentStep > 1) {
        document.querySelector(`.form-step[data-step="${currentStep}"]`).classList.remove('active');
        currentStep--;
        document.querySelector(`.form-step[data-step="${currentStep}"]`).classList.add('active');
        updateProgressBar(currentStep);
    }
}

// Validar el paso actual
function validateCurrentStep() {
    const currentFormStep = document.querySelector(`.form-step[data-step="${currentStep}"]`);
    const requiredFields = currentFormStep.querySelectorAll('[required]');

    let valid = true;
    requiredFields.forEach(field => {
        if (!field.value.trim()) {
            field.style.borderColor = 'var(--accent-color)';
            valid = false;
        } else {
            field.style.borderColor = '';
        }
    });

    if (!valid) {
        const existingErrorMsg = currentFormStep.querySelector('.error-message');
        if (!existingErrorMsg) {
            const errorMsg = document.createElement('p');
            errorMsg.className = 'error-message';
            errorMsg.style.color = 'var(--accent-color)';
            errorMsg.style.marginTop = '10px';
            errorMsg.style.textAlign = 'center';
            errorMsg.innerHTML = '<i class="fas fa-exclamation-circle"></i> Por favor, completa todos los campos requeridos.';
            currentFormStep.querySelector('.buttons-group').before(errorMsg);

            setTimeout(() => {
                if (errorMsg.parentNode) {
                    errorMsg.parentNode.removeChild(errorMsg);
                }
            }, 3000);
        }
    }

    return valid;
}

// Actualizar la barra de progreso
function updateProgressBar(step) {
    document.querySelectorAll('.progress-step').forEach((stepElement, index) => {
        if (index + 1 < step) {
            stepElement.classList.add('completed');
            stepElement.classList.remove('active');
        } else if (index + 1 === step) {
            stepElement.classList.add('active');
            stepElement.classList.remove('completed');
        } else {
            stepElement.classList.remove('active', 'completed');
        }
    });

    const progressLine = document.getElementById('progressLine');
    const progressPercentage = ((step - 1) / 5) * 100;
    progressLine.style.width = `${progressPercentage}%`;
}

// Enviar respuestas
function submitAnswers() {
    if (!validateCurrentStep()) {
        return;
    }

    document.getElementById('loadingOverlay').style.display = 'flex';

    setTimeout(() => {
        const playerName = document.getElementById('playerName').value.trim();
        const department = document.getElementById('department').value.trim();
        const why1 = document.getElementById('why1').value.trim();
        const why2 = document.getElementById('why2').value.trim();
        const why3 = document.getElementById('why3').value.trim();
        const why4 = document.getElementById('why4').value.trim();
        const why5 = document.getElementById('why5').value.trim();

        participants.push({
            name: playerName,
            department: department,
            answers: [why1, why2, why3, why4, why5],
            timestamp: new Date().toLocaleString()
        });

        saveToLocalStorage();
        updateResults();
        triggerConfetti();
        resetForm();
        document.querySelector('.tab[data-tab="results"]').click();
        document.getElementById('loadingOverlay').style.display = 'none';
    }, 1000);
}

// Guardar datos en localStorage
function saveToLocalStorage() {
    localStorage.setItem('ypfb5whys_participants', JSON.stringify(participants));
}

// Cargar datos desde localStorage
function loadFromLocalStorage() {
    const savedData = localStorage.getItem('ypfb5whys_participants');
    if (savedData) {
        participants = JSON.parse(savedData);
        updateResults();
    }
}

// Actualizar vista de resultados
function updateResults() {
    if (participants.length === 0) {
        document.getElementById('results').style.display = 'none';
        document.getElementById('noResultsMessage').style.display = 'block';
        return;
    }

    document.getElementById('results').style.display = 'block';
    document.getElementById('noResultsMessage').style.display = 'none';

    document.getElementById('totalParticipants').textContent = participants.length;
    const uniqueDepartments = [...new Set(participants.map(p => p.department))];
    document.getElementById('totalDepartments').textContent = uniqueDepartments.length;

    const commonPoints = findCommonPoints();
    document.getElementById('commonPointsCount').textContent = commonPoints.length;

    const resultsGrid = document.getElementById('resultsGrid');
    resultsGrid.innerHTML = '';

    participants.forEach((participant, index) => {
        const card = document.createElement('div');
        card.className = 'answer-card';
        const initial = participant.name.charAt(0).toUpperCase();

        card.innerHTML = `
            <div class="answer-card-header">
                <div class="user-avatar">${initial}</div>
                <div>
                    <h4>${participant.name}</h4>
                    <small>${participant.department} - ${participant.timestamp}</small>
                </div>
            </div>
            ${participant.answers.map((answer, i) => `
                <div class="answer-item">
                    <span class="answer-item-number">${i + 1}</span>
                    ${answer}
                </div>
            `).join('')}
            <button class="btn" style="padding: 5px 10px; font-size: 0.8em; margin-top: 10px;" 
                    onclick="removeParticipant(${index})">
                <i class="fas fa-trash"></i> Eliminar
            </button>
        `;
        resultsGrid.appendChild(card);
    });

    const commonPointsList = document.getElementById('commonPointsList');
        commonPointsList.innerHTML = '';

        if (commonPoints.length > 0) {
            commonPoints.forEach(point => {
                const item = document.createElement('div');
                item.className = 'common-point-item';
                item.innerHTML = `
                    <i class="fas fa-dot-circle"></i>
                    <span>${point.text}</span>
                    <span class="badge">${point.count} coincidencias</span>
                `;
                commonPointsList.appendChild(item);
            });
        } else {
            commonPointsList.innerHTML = '<p>No se encontraron puntos en común significativos entre las respuestas.</p>';
        }

    if (participants.length > 0) {
        generateWordCloud();
        generateCharts();
    }
}

// Eliminar un participante
function removeParticipant(index) {
    if (confirm('¿Estás seguro de que deseas eliminar esta respuesta?')) {
        participants.splice(index, 1);
        saveToLocalStorage();
        updateResults();
        if (participants.length === 0) {
            checkForResults();
        }
    }
}

// Encontrar puntos en común entre respuestas
function findCommonPoints() {
    const allAnswers = participants.flatMap(p => p.answers);
    const answerCounts = {};

    allAnswers.forEach(answer => {
        const normalized = answer.toLowerCase().trim();
        answerCounts[normalized] = (answerCounts[normalized] || 0) + 1;
    });

    const commonPoints = Object.keys(answerCounts)
        .filter(answer => answerCounts[answer] > 1)
        .map(answer => ({
            text: answer,
            count: answerCounts[answer]
        }))
        .sort((a, b) => b.count - a.count);

    return commonPoints;
}

// Generar nube de palabras
function generateWordCloud() {
    const wordCloudDiv = document.getElementById('wordCloudChart');
    wordCloudDiv.innerHTML = '';

    const allText = participants.flatMap(p => p.answers).join(' ');
    const words = allText.toLowerCase().split(/\s+/);
    const wordCounts = {};
    const stopWords = ['el', 'la', 'los', 'las', 'un', 'una', 'y', 'o', 'de', 'del', 'a', 'en', 'que', 'por', 'para', 'con', 'se', 'su'];

    words.forEach(word => {
        word = word.replace(/[.,;:'"!?()]/g, '');
        if (word.length > 3 && !stopWords.includes(word)) {
            wordCounts[word] = (wordCounts[word] || 0) + 1;
        }
    });

    const sortedWords = Object.keys(wordCounts)
        .map(word => ({ text: word, count: wordCounts[word] }))
        .sort((a, b) => b.count - a.count)
        .slice(0, 25);

    sortedWords.forEach(word => {
        const fontSize = Math.max(14, Math.min(40, 14 + word.count * 2));
        const span = document.createElement('span');
        span.textContent = word.text;
        span.style.fontSize = `${fontSize}px`;
        span.style.padding = '5px';
        span.style.margin = '5px';
        span.style.display = 'inline-block';
        span.style.color = `hsl(${Math.random() * 360}, 70%, 40%)`;
        wordCloudDiv.appendChild(span);
    });
}

// Generar gráficos para el dashboard
function generateCharts() {
    const categoriesChart = document.getElementById('categoriesChart').getContext('2d');
    const rootCausesChart = document.getElementById('rootCausesChart').getContext('2d');

    const finalResponses = participants.map(p => p.answers[4]);
    const categories = {};
    finalResponses.forEach(response => {
        const category = response.split(' ')[0].toLowerCase();
        categories[category] = (categories[category] || 0) + 1;
    });

    if (window.categoriesChartObj) {
        window.categoriesChartObj.destroy();
    }

    window.categoriesChartObj = new Chart(categoriesChart, {
        type: 'bar',
        data: {
            labels: Object.keys(categories),
            datasets: [{
                label: 'Frecuencia de causas',
                data: Object.values(categories),
                backgroundColor: 'rgba(0, 48, 135, 0.7)',
                borderColor: 'rgba(0, 48, 135, 1)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'top',
                },
                title: {
                    display: true,
                    text: 'Categorías de Causas Raíz'
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    const rootCauses = {};
    finalResponses.forEach(response => {
        const simplified = response.length > 30 ? response.substring(0, 30) + '...' : response;
        rootCauses[simplified] = (rootCauses[simplified] || 0) + 1;
    });

    if (window.rootCausesChartObj) {
        window.rootCausesChartObj.destroy();
    }

    window.rootCausesChartObj = new Chart(rootCausesChart, {
        type: 'doughnut',
        data: {
            labels: Object.keys(rootCauses),
            datasets: [{
                data: Object.values(rootCauses),
                backgroundColor: [
                    'rgba(211, 47, 47, 0.7)',
                    'rgba(0, 48, 135, 0.7)',
                    'rgba(76, 175, 80, 0.7)',
                    'rgba(255, 193, 7, 0.7)',
                    'rgba(156, 39, 176, 0.7)'
                ],
                borderColor: [
                    'rgba(211, 47, 47, 1)',
                    'rgba(0, 48, 135, 1)',
                    'rgba(76, 175, 80, 1)',
                    'rgba(255, 193, 7, 1)',
                    'rgba(156, 39, 176, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'top',
                },
                title: {
                    display: true,
                    text: 'Distribución de Causas Raíz'
                }
            }
        }
    });

    // Árbol de problemas (implementación simple usando HTML/CSS)
    const problemTree = document.getElementById('problemTree');
    problemTree.innerHTML = '';

    const treeContainer = document.createElement('div');
    treeContainer.style.display = 'flex';
    treeContainer.style.flexDirection = 'column';
    treeContainer.style.alignItems = 'center';
    treeContainer.style.padding = '20px';

    const problemNode = document.createElement('div');
    problemNode.style.background = 'var(--accent-color)';
    problemNode.style.color = 'white';
    problemNode.style.padding = '10px 20px';
    problemNode.style.borderRadius = '8px';
    problemNode.style.marginBottom = '20px';
    problemNode.textContent = 'Retraso en proyectos de industrialización';
    treeContainer.appendChild(problemNode);

    const branches = document.createElement('div');
    branches.style.display = 'flex';
    branches.style.gap = '20px';
    branches.style.flexWrap = 'wrap';
    branches.style.justifyContent = 'center';

    finalResponses.forEach((response, index) => {
        if (index < 5) { // Limitar a 5 ramas para evitar sobrecarga visual
            const branch = document.createElement('div');
            branch.style.background = 'var(--primary-light)';
            branch.style.padding = '10px';
            branch.style.borderRadius = '8px';
            branch.style.maxWidth = '200px';
            branch.style.textAlign = 'center';
            branch.textContent = response.length > 50 ? response.substring(0, 50) + '...' : response;
            branches.appendChild(branch);
        }
    });

    treeContainer.appendChild(branches);
    problemTree.appendChild(treeContainer);
}

// Verificar si hay resultados
function checkForResults() {
    if (participants.length === 0) {
        document.getElementById('results').style.display = 'none';
        document.getElementById('noResultsMessage').style.display = 'block';
    } else {
        document.getElementById('results').style.display = 'block';
        document.getElementById('noResultsMessage').style.display = 'none';
        updateResults();
    }
}

// Reiniciar formulario
function resetForm() {
    document.getElementById('whysForm').reset();
    currentStep = 1;
    document.querySelectorAll('.form-step').forEach(step => step.classList.remove('active'));
    document.querySelector('.form-step[data-step="1"]').classList.add('active');
    updateProgressBar(1);
}

// Reiniciar juego
function resetGame() {
    if (confirm('¿Estás seguro de que deseas reiniciar el juego? Esto eliminará todas las respuestas.')) {
        participants = [];
        localStorage.removeItem('ypfb5whys_participants');
        resetForm();
        updateResults();
        document.querySelector('.tab[data-tab="game"]').click();
    }
}

// Generar PDF
function generatePDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    doc.setFontSize(16);
    doc.text('Juego de los 5 Porqués - YPFB', 20, 20);
    doc.setFontSize(12);
    doc.text('Resultados de los Participantes', 20, 30);

    let y = 40;
    participants.forEach((participant, index) => {
        if (y > 260) {
            doc.addPage();
            y = 20;
        }
        doc.setFontSize(14);
        doc.text(`Participante ${index + 1}: ${participant.name} (${participant.department})`, 20, y);
        y += 10;
        participant.answers.forEach((answer, i) => {
            doc.setFontSize(10);
            doc.text(`Por qué ${i + 1}: ${answer.substring(0, 80)}${answer.length > 80 ? '...' : ''}`, 25, y);
            y += 10;
        });
        y += 10;
    });

    const commonPoints = findCommonPoints();
    if (commonPoints.length > 0) {
        doc.addPage();
        doc.setFontSize(14);
        doc.text('Puntos en Común', 20, 20);
        y = 30;
        commonPoints.forEach(point => {
            doc.setFontSize(10);
            doc.text(`${point.text} (${point.count} coincidencias)`, 25, y);
            y += 10;
        });
    }

    doc.save('Resultados_5_Whys_YPFB.pdf');
}

// Exportar resultados como JSON
function exportResults() {
    const dataStr = JSON.stringify(participants, null, 2);
    const blob = new Blob([dataStr], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = 'resultados_5whys_ypfb.json';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);
}

// Efecto confeti
function triggerConfetti() {
    confetti({
        particleCount: 100,
        spread: 70,
        origin: { y: 0.6 }
    });
}

// Inicializar botón de scroll hacia arriba
function initScrollToTop() {
    const scrollToTop = document.getElementById('scrollToTop');
    window.addEventListener('scroll', () => {
        if (window.scrollY > 300) {
            scrollToTop.classList.add('show');
        } else {
            scrollToTop.classList.remove('show');
        }
    });

    scrollToTop.addEventListener('click', () => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    });
}

// Inicializar cambio de tema
function initThemeToggle() {
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');

    themeToggle.addEventListener('click', () => {
        darkTheme = !darkTheme;
        document.body.classList.toggle('dark-theme', darkTheme);

        // Cambiar el ícono según el tema
        themeIcon.className = darkTheme ? 'fas fa-sun' : 'fas fa-moon';
        themeToggle.setAttribute('aria-label', darkTheme ? 'Cambiar a tema claro' : 'Cambiar a tema oscuro');
    });
}

// Cargar datos al iniciar
window.onload = function () {
    loadFromLocalStorage();
};
</script>
</body>
</html>
